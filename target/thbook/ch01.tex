\eject \ifodd\pageno\else\hbox{}\eject\fi 

{\baselineskip=12pt \setbox1=\hbox{\eightit ПУСТЬ НЕ ВХОДИТ НИКТО, НЕ ЗНАЮЩИЙ ГЕОМЕТРИИ} \copy1 \vskip4pt \line{\pic[\wd1]{ageom.pdf}\hss} \hbox to \wd1{\hfil\eightrm --- {\font\tt=fhar6a at 8px \tt предполагаемая фраза над входом}} \hbox to \wd1{\hfil\eightrm {\font\tt=fhar6a at 8px \tt в Академию Платона}, {\eightmit 4} {\font\tt=fhar6a at 8px \tt век до н.э.}} 

\chapter Введение. 

Therion это программа для создания карт пещер. Ее цель состоит в том, чтобы помочь: 

\list

* архивировать данные съемки на компьютере в форме, максимально\break приближенной к оригинальным записям и зарисовкам, и обрабатывать их удобным и эффективным способом; * рисовать красивые современные планы и разрезы; * создавать реалистичные 3D-модели пещер. \endlist

Therion работает в операционных системах Unix, Linux, MacOS X и Win32. Исходный код и установщик для Windows доступны на веб-странице\break(\www{https://therion.speleo.sk}). 

Therion распространяется под лицензией  \www[GNU General Public License] {https://www.gnu.org/}. 

\subchapter Почему Therion?. 

В 1990-е мы активно занимались спелеологией и созданием карт. Имелось несколько компьютерных программ, которые строили нитку хода после\break закрытия колец и разброса ошибки. Это было большим подспорьем в работе, особенно работая над крупными и сложными пещерными системами. Мы использовали вывод одного из них (TJIKPR) в качестве фонового слоя со станциями для ручного рисования карт. После окончания огромного\break 166-страничного Атласа пещер мертвых летучих мышей в начале 1997 года у нас вскоре возникла проблема: мы нашли новые ходы, соединения между известными ходами. После обработки данных в TJIKPR, новые кольца\break повлияли на положение старых станций, большинство станций уже имели иную позицию из-за разброса невязки колец. Таким образом мы могли бы перерисовывать весь Атлас снова, или принять, что местоположение некоторых новых мест на карте было изображено не точно (в случае колец с длиной около 1 км ошибки достигали 10 м) и пытаться подогнать новые хода к старым съемкам. 

Эти проблемы оставались, когда мы пытались рисовать карты с помощью некоторых программ CAD в 1998 и 1999 годах. Всегда было трудно добавить новые исследования без адаптации старых к новым рассчитанным позициям станций во всей пещере. Мы не нашли ни одной программы, которая могла бы нарисовать современную сложную карту (т.е. не только нитку хода с LRUD), в которых старые части съемки изменялись в соответствии с новыми расчетными координатами станций. 

В 1999 году мы начали думать о создании собственной программы для\break рисования карт. Мы знали о программах, которые идеально подходили для конкретных подзадач. Это был \MP\  -- язык программирования высокого уровня для описания векторной графики, Survex -- отличная\break программа для обработки нитки хода, и \TeX\  -- для верстки результатов. Нужно было только сложить их вместе. В рождество 1999 года мы уже имели первую версию Therion'а. Она состояла примерно из 32 КБ Perl скриптов и \MP \ макросов, но программа показала, что наши идеи были осуществимы. 

В период 2000--2001 годов мы искали оптимальный формат входных данных, язык программирования, концепцию интерактивного редактирования карт и внутренних алгоритмов с помощью Martin Sluka (Прага) и Martin Heller (Z\"urich). В 2002 году мы представили первую версию Therion'а, которая отвечала нашим требованиям. 

\subchapter Особенности. 

Therion -- приложение для командной строки. Он обрабатывает входные файлы в текстовом формате, в том числе 2D-карты, и создает файлы с\break 2D-картами или 3D-моделью в качестве вывода. 

Синтаксис входных файлов подробно описан в последующих главах. Вы можете создавать эти файлы в любом текстовом редакторе, например\break {\it ed} или {\it vi}. Файлы содержат инструкции для Therion'а, такие как: 

|point 1303 1004 pillar| 

где  {\tt point} -- команда для символа точки, за которым следуют его координаты и специфический тип символа. 

Ручное редактирование таких файлов непросто, особенно когда вы рисуете карты и вам нужно думать о пространственных (декартовых координатах). Поэтому существует специальный графический интерфейс для Therion,\break называемый XTherion. XTherion работает как расширенный\break текстовый редактор, редактор карт (где карты рисуются в полностью\break интерактивном режиме) и компилятор (который запускает Therion). 

Это может выглядеть довольно сложно, но этот подход имеет много\break преимуществ: 

\list

* Строгое разделение данных и визуализации. В файлах данных\break указывается только то, что есть, а не то, на что это похоже. Визуальное представление добавляется \MP\  на более поздних этапах обработки данных (это очень похоже на представление XML-данных). 

Это позволяет изменять символы карты, используемые без изменения\break входных данных, или объединить большие карты, созданные разными людьми в разных стилях, в одну карту с едиными символами. 

2D-карты адаптированы для конкретного масштаба (уровень абстракции, нелинейное масштабирование символов и текстов). 

* Все данные привязываются к положениям пикетов съемки. Если\break координаты станций съемки изменяются в процессе закрытия колец, то все связанные данные перемещаются соответственно, поэтому карта\break всегда актуальна. 

* Therion не зависит от конкретной операционной системы, кодировки\break символов или редактора входных файлов; входные файлы останутся\break читабельными для человека. 

* Можно добавить новые форматы вывода. 

* 3D-модель создается из 2D-карт, чтобы получить реалистичную\break трехмерную модель не вводя слишком много данных. 

* Хотя поддержка WYSIWYG ограничена, вы всегда можете получить то, что хотите. \endlist

\subchapter Требования к ПО. 

``Программа должна делать одну задачу, и должна делать это хорошо'' (Кен Томпсон). Поэтому мы используем несколько внешних программ, которые обрабатывают и визуализируют данные. Therion в связке с другими\break программами может выполнить свою задачу намного лучше. 

Therion'у необходимо: \list

* \TeX\ дистрибутив. Необходимо только в том случае, если вы хотите\break создавать 2D-карты в формате PDF или SVG. * Tcl/Tk с  {\it BWidget} и опциональным расширением {\it tkImg}. Это требуется только для XTherion. * LCDF Typetools, если вы хотите использовать легкую настройку для\break пользовательских шрифтов в PDF-картах. * Утилиты {\it convert} и {\it identify} из дистрибутива ImageMagick, если вы хотите использовать деформирование эскизов. * {\it ghostscript}, если вы хотите создавать калиброванные изображения с\break геопривязанными PDF-картами. \endlist

Установщик для Windows включает все необходимые пакеты, за\break исключением {ghostscript}. Прочтите {\it Приложение}, если вы хотите\break скомпилировать Therion самостоятельно. 

Для отображения карт и моделей вы можете использовать любую из\break следующих программ: \list

* любой просмотрщик PDF или SVG для просмотра 2D-карт; * любые GIS поддерживающие DXF или {\it shapefile} форматы для анализа карт; * соответствующий 3D просмотрщик для моделей, экспортированных в\break формате отличном от стандартного; * любой клиент базы данных SQL для обработки экспортированной базы данных. \endlist

\subchapter Инсталляция. 

{\bf Установка из исходников (therion-5.*.tar.gz package):} 

Исходники -- главный дистрибутив Therion. Его необходимо скомпилировать и установить в соответствии с инструкциями в {\it Приложении}. 

{\bf Установка в Windows:} 

Запустите программу установки и следуйте инструкциям. Он устанавливает все необходимые материалы и создает ярлыки для XTherion и Therion Book. 

\subsubchapter Настройка среды. 

Therion считывает настройки из файла инициализации. Настройки по\break умолчанию должны работать отлично для пользователей использующих\break только латинские символы \[ На PDF-картах Therion отображает большинство акцентированных символов как\break сочетание акцента и базового символа. Некоторые неявные акценты могут быть\break опущены. Предустановленные буквы с акцентом включены для словацкого и чешского языков.], стандартные \TeX\ и \MP. 

Если вы хотите использовать собственные шрифты для латинских или не латинских символов в PDF-картах, отредактируйте файл инициализации. Инструкции о том, как это сделать, приведены в {\it Приложении}. 

\subchapter Как это работает?. 

Итак, теперь ясно, что нужно Therion'у, давайте посмотрим как он\break взаимодействует со всеми этими программами: 

\par\penalty-200 \midinsert

\centerline{\MPpic{schema.1}} \endinsert

НЕ ПАНИКУЙТЕ! Когда ваша система настроена правильно, большинство из файлов скрыто от пользователя, и все необходимые программы\break автоматически запускаются Therion'ом. 

Для работы с Therion'ом достаточно знать, что вам нужно создавать входные данные (лучше всего делать это в XTherion), запускать Therion и отображать выходные файлы (3D-модель, карта, лог-файл) в соответствующей\break программе. 

Для тех, кто хочет больше узнать об этом, кратко изложим приведенную выше блок-схему. Названия программ отображены прямым шрифтом, а файлы данных выделены курсивом. Стрелки показывают поток данных между программами. Временные файлы данных не показаны. Значение цветов: 

\list

* черный -- программы и макросы Therion'а (XTherion написан на Tcl/Tk, поэтому для него требуется этот интерпретатор); * красный -- \TeX\  пакет; * зеленый -- входные файлы, созданные пользователем и выходные файлы, созданные Therion'ом. \endlist

Сам Therion выполняет главную задачу. Он считывает входные файлы, интерпретирует их, находит замкнутые кольца и раскидывает ошибки.\break Затем он преобразует все другие данные (например 2D-карты) в\break соответствии с позицией новых станций. Therion экспортирует данные для 2D-карт в формате \MP. \MP\ дает фактическую форму\break абстрактным символам карты в соответствии с определениями символов\break карты; он создает много файлов PostScript с небольшими фрагментами\break пещеры. Они считываются и преобразуются в PDF формат, который\break формирует входные данные для pdf\TeX. Pdf\TeX\  собирает все фрагменты и создает PDF-файл карты пещеры. 

Therion также экспортирует трехмерную модель (полную или нитку хода) в различных форматах. 

Нитка хода может быть экспортирована для дальнейшей обработки в любую базу данных SQL. 

\subchapter Первый запуск. 

После объяснения основных принципов работы Therion'а давайте попробуем его на примерах реальных данных. 

\list

* Скачайте примеры данных с сайта Therion'а и распакуйте их на жесткий диск. * Запустите XTherion (под Unix и MacOS X введя в командной строке\break `xtherion', под Windows ярлык в меню {\it Старт}). Откройте файл `thconfig' из каталога примеров данных в окне `therion компилятор'. * Нажмите `F9' или `Компилировать' в меню для запуска Therion'а -- вы получите несколько сообщений от Therion'а, \MP \ и \TeX. PDF-карты и 3D-модель создаются в каталоге с данными. \endlist

Кроме того, вы можете открыть файлы данных съемки (*.th) в окне `therion текстовый редактор' и файлы абрисов карт (*.th2) в окне `therion редактор карт'. Наличие различных форматов данных может выглядеть запутанным по началу, но все они будут разъяснены в следующих главах. 

\endinput

